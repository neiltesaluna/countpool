<div id="local_timer_js" class="row"</div>


<script>


// used to sort the timers by date

function asc(a, b) {

  let asc = 0;
  if (a.goal > b.goal) {
    asc = 1;
  } else if (a.goal < b.goal) {
    asc = -1;
  }
  return asc;
}

// used to delete the local timer

function delete_localtimer(id, local_check) {
  if (local_check === "True") {
    var [_, id] = id.split('local_');
    delete localTimers[id]
    localStorage.setItem('localTimers', JSON.stringify(localTimers));
      if (localTimers.every(element => element === null)) {
        localStorage.removeItem("localTimers")
      }
    location.reload()
  }

  else {
    window.location.href = "{{ url_for('delete_timer', id='pass_id') }}".replace('pass_id', id)
  }
}

// passing in the dbTimers, localStorage timers, merge and sort

var dbTimers = {{ timers | tojson }}
console.log(dbTimers)
var localTimers = JSON.parse(window.localStorage.getItem('localTimers')) || [];
console.log(localTimers)

// merging timers stored in the database and local storage
combinedTimers = localTimers.concat(dbTimers)

// removing null objects before sorting the timers
combinedTimers = combinedTimers.filter((obj) => obj )
combinedTimers.sort(asc);
console.log(combinedTimers)


// passing local storage data

function timerTemplate(timer) {

  if (timer){
    setTimer(timer.goal, timer.id);

    return `
    <div style="padding: 1rem">

      <div class="card card-hover" style="width: 19.6rem; background-color: #5b5656;" data-toggle="modal" data-target="#Modal-${timer.id}">
        <div class="reveal-text">
          <h6 class="card-text">${timer.title}</h6>
          <p class="card-text"id='${timer.id}'></p>
        </div>
        <div class="reveal">
          <img src="{{ url_for('static', filename='bg-image/') }}${timer.image}" class="img-fluid" alt="">
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="Modal-${timer.id}" tabindex="-1" role="dialog" aria-labelledby="Modal-${timer.id}" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">${timer.title}</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">Ã—</span>
            </button>
          </div>
          <div class="modal-body mx-auto">

            <img src="{{ url_for('static', filename='bg-image/') }}${timer.image}" class="rounded img-fluid" alt="">

          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-light" data-dismiss="modal">Close</button>
            <button onclick="delete_localtimer('${timer.id}','${timer.local_check}')" class="btn btn-danger">delete</button>
          </div>
        </div>
      </div>
    </div>
    `
  }
;

}

document.getElementById("local_timer_js").innerHTML = `
  ${combinedTimers.map(timerTemplate).join("")}
`;

</script>
